2
∂V
∂q (qn)
qn+1 ←qn + ϵ pn+ 1
2
pn+1 ←pn+ 1
2 −ϵ
2
∂V
∂q (qn+1)
end for.
This simple but precise interleaving of discrete momentum and position updates ensures
exact volume preservation on phase space, and hence the accurate numerical trajectories

38
BETANCOURT
Fig 29. When the exact trajectories lie on energy level sets with regions of high curvature, the numerical
trajectories generated by symplectic integrators can diverge, rapidly ﬂying oﬀtowards the boundaries of phase
space. Unlike the slower drift of generic numerical integrators, these divergences, and hence the failure of
the symplectic integrator to provide an accurate solution, are straightforward to identify in practice.
we need to realize the potential of a Hamiltonian transition.
There is, however, one important exception to performance of symplectic integrators.
Long time accuracy can be compromised when the exact energy level sets feature neigh-
borhoods of high curvature that the ﬁnite time discretization is not able to resolve. These
neighborhoods induce a divergence that almost immediately propels the numerical trajec-
tory towards inﬁnite energies (Figure 29). This distinctive behavior proves beneﬁcial in
practice, however, because it makes the failures of a symplectic integrator straightforward
to identify and hence diagnose.
Employing symplectic integrators provides the opportunity to translate the theoretical
performance of the Hamiltonian Monte Carlo method into a practical implementation.
There remain, however, two obstructions to realizing this translation. First, even though
symplectic integrators are highly accurate, the small errors they do introduce will bias the
resulting Hamiltonian transitions without an exact correction. Second, we have to be able
to select a symplectic integrator well-suited to a given target distribution.
5.2 Correcting for Symplectic Integrator Error
One particularly natural strategy for correcting the bias introduced by the error in a
symplectic integrator is to treat the Hamiltonian transition as the proposal for a Metropolis-
Hastings scheme on phase space. If we can construct the acceptance probability analytically
then this correction will yield an exact sample from the canonical distribution on phase
space which then projects to an exact sample from our target distribution. In order to con-
struct that acceptance probability, however, we have to carefully augment the Hamiltonian
transition.
For example, consider a simple scheme where we integrate the initial state, (q0, p0), for-

A CONCEPTUAL INTRODUCTION TO HAMILTONIAN MONTE CARLO
39
(q0, p0)
(qL, pL)
Q(qL, pL | q0, p0) = 1
(q0, p0)
(qL, pL)
(q2L, p2L)
Q(q0, p0 | qL, pL) = 0
Fig 30. Because Hamiltonian trajectories, and their numerical approximations, are deterministic and non-
reversible, Metropolis-Hastings proposals are always rejected. In particular, we have positive proposal prob-
abilities going forwards in time but vanishing proposal probabilities going backwards in time which renders
the Metropolis-Hastings acceptance probability identically zero.
ward for some static time, or equivalently L symplectic integrator steps, and then propose
the last state of the numerical trajectory, (qL, pL),
Q(q′, p′ | q0, p0) = δ(q′ −qL) δ(p′ −pL).
Because we can propose only states going forwards and not backwards, (Figure 30), the ratio
of proposal densities, and hence the Metropolis-Hastings acceptance probability, always
vanishes,
Q(q0, p0 | qL, pL)
Q(qL, pL | q0, p0) = 0
1.
If we modify the Hamiltonian transition to be reversible, however, then the ratio of pro-
posal densities becomes non-zero and we achieve a useful correction scheme. The simplest
way of achieving a reversible proposal is to augment the the numerical integration with a
negation step that ﬂips the sign of momentum,
(q, p) →(q, −p) .
This yields the reversible proposal (Figure 31)
Q(q′, p′ | q0, p0) = δ(q′ −qL) δ(p′ + pL),
with the corresponding Metropolis-Hastings acceptance probability
a(qL, −pL | q0, p0) = min

1, Q(q0, p0 | qL, −pL) π(qL, −pL)
Q(qL, −pL | q0, p0) π(q0, p0)

= min

1, δ(qL −qL) δ(−pL + pL) π(qL, −pL)
δ(q0 −q0) δ(p0 −p0) π(q0, p0)

= min

1, π(qL, −pL)
π(q0, p0)

= min

1, exp (−H(qL, −pL))
exp (−H(q0, p0))

= min(1, exp (−H(qL, −pL) + H(q0, p0))) ,

40
BETANCOURT
(q0, p0)
(qL, pL)
